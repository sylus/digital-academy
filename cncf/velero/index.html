<!DOCTYPE html>
<!--[if lt IE 9]><html class="no-js lt-ie9" lang="en" dir="ltr">><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"  >
<!--<![endif]-->
    <head>

        <meta charset="utf-8">
        <meta content="width=device-width,initial-scale=1" name="viewport">    
    <!-- Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW)
            wet-boew.github.io/wet-boew/License-en.html / wet-boew.github.io/wet-boew/Licence-fr.html -->
    <title>Velero (Formerly Ark)</title>        
        <meta name="description" content="">    
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js" type="text/javascript"></script>
    <script>var custom_styling = document.createElement("script");</script>
    
    <link href="/digital-academy/lib/@gctools-components/aurora-ds/css/aurora.min.css" rel="stylesheet" type="text/css">
    
    <link href="/digital-academy/lib/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
</head>
    <body vocab="http://schema.org/" typeof="WebPage">    
    <script src="/digital-academy/lib/@gctools-components/aurora-ds/js/aurora.min.js" type="text/javascript"></script>

            <ul class ="sr-only">
                <li class="wb-slc">
                    <a class="wb-sl" href="#wb-cont">
                        
                            Skip to main content
                        
                    </a>
                </li>
                <li class="wb-slc">
                    <a class="wb-sl" href="#wb-info">
                        
                            Skip to "About government"
                        
                    </a>
                </li>
            </ul>

        <header>
            <nav class="main-nav navbar navbar-expand bg-white" typeof="SiteNavigationElement">
    <div class="navbar-collapse nav-holder">
        <ul class="mx-auto nav-site scroll nav nav-tabs" style="border-bottom: none;">
            
            
            
            <li class="nav-item">
            <a class="nav-link" href="https://github.com/statcan/statcan">
                <i class='fa fa-github'></i>
                <span>GitHub</span>
            </a>
            
            </li>
            
        </ul>
    </div>
</nav>

            <nav aria-label="breadcrumb">
                <h2 class="sr-only">You are here:</h2>
                <div class="container">
                    
                    
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="https://sylus.ca/digital-academy/">Home</a></li>
                        
                            <li class="breadcrumb-item">&nbsp;Velero (Formerly Ark)</li>
                        
                    </ol>
                </div>
            </nav>
        </header>
<main property="mainContentOfPage" class="container"><link rel="stylesheet" href="https://sylus.ca/digital-academy//css/custom.css">
<h1 id="wb-cont">Velero (Formerly Ark)</h1><div class="row mrgn-tp-lg">
    <div class="col-md-12">
        <div class="row">
            <div class="col-md-6 col-sm-6">
                <div id="toc" class="panel panel-default">
                    <header class="panel-heading">
                        <h2 class="h4 mrgn-tp-0">Table of Contents</h2>
                    </header>
                    <div class="panel-body">
                        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#interactive-learning-environment">Interactive Learning Environment</a></li>
<li><a href="#background">Background</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#velero-backup">Velero Backup</a></li>
<li><a href="#velero-schedule">Velero Schedule</a></li>
<li><a href="#velero-restore">Velero Restore</a></li>
</ul></li>
</ul>
</nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


        


<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/sHLRedoRSp0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>


<h2 id="interactive-learning-environment">Interactive Learning Environment</h2>

<p>In this lab, we will examine the Docker CLI and execute our first container.</p>

<ul>
<li><a href="https://katacoda.com/sylus/courses/kubernetes-cncf/module-2">Kubernetes CNCF: Module 2 - Heptio Velero</a></li>
</ul>

<blockquote>
<p>All of our labs are powered by <a href="https://katacoda.com">Katacoda</a> and are located at this <a href="https://katacoda.com/sylus">Profile</a>.</p>
</blockquote>

<h2 id="background">Background</h2>

<p>Heptio Velero is a utility for managing disaster recovery, specifically for your Kubernetes cluster resources and persistent volumes.</p>

<p>Velero gives you tools to back up and restore your Kubernetes cluster resources and persistent volumes. Velero lets you:</p>

<ul>
<li>Take backups of your cluster and restore in case of loss.</li>
<li>Copy cluster resources across cloud providers. NOTE: Cloud volume migrations are not yet supported.</li>
<li>Replicate your production environment for development and testing environments.</li>
</ul>

<p>Velero consists of the following:</p>

<ul>
<li>A server that runs on your cluster</li>
<li>A command-line client that runs locally</li>
</ul>

<h2 id="installation">Installation</h2>

<p>The following is a rough example of how an installation looks like for a Kubernetes cluster when restoring snapshots in Azure.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">AZURE_STORAGE_ACCOUNT_ID<span style="color:#f92672">=</span>velero
AZURE_STORAGE_KEY<span style="color:#f92672">=</span>&lt;storage_key&gt;
AZURE_TENANT_ID<span style="color:#f92672">=</span>&lt;tenant_id&gt;
AZURE_SUBSCRIPTION_ID<span style="color:#f92672">=</span>&lt;subscription_id&gt;
AZURE_RESOURCE_GROUP<span style="color:#f92672">=</span>management
AZURE_CLIENT_ID<span style="color:#f92672">=</span>&lt;client_id&gt;
AZURE_CLIENT_SECRET<span style="color:#f92672">=</span>&lt;client_secret&gt;

kubectl apply -f examples/common/00-prereqs.yaml

kubectl create secret generic cloud-credentials <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --namespace heptio-ark <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --from-literal AZURE_SUBSCRIPTION_ID<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>AZURE_SUBSCRIPTION_ID<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --from-literal AZURE_TENANT_ID<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>AZURE_TENANT_ID<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --from-literal AZURE_RESOURCE_GROUP<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>AZURE_RESOURCE_GROUP<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --from-literal AZURE_CLIENT_ID<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>AZURE_CLIENT_ID<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --from-literal AZURE_CLIENT_SECRET<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>AZURE_CLIENT_SECRET<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --from-literal AZURE_STORAGE_ACCOUNT_ID<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>AZURE_STORAGE_ACCOUNT_ID<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --from-literal AZURE_STORAGE_KEY<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>AZURE_STORAGE_KEY<span style="color:#e6db74">}</span>

kubectl apply -f examples/azure/</code></pre></div>
<h2 id="velero-backup">Velero Backup</h2>

<p>Backup an application along with persistent volumes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ark backup create traefik-backup --selector app<span style="color:#f92672">=</span>traefik <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                                 --snapshot-volumes <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                                 -n kube-system</code></pre></div>
<p>Backup the Entire cluster with persistent volumes excluding the kube-system and heptio-ark namespaces.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ark backup create all --exclude-namespaces<span style="color:#f92672">=</span>kube-system,heptio-ark <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                      --snapshot-volumes</code></pre></div>
<h2 id="velero-schedule">Velero Schedule</h2>

<p>Schedule a backup that will run on a cron schedule.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ark schedule create artifactory-backup --selector app<span style="color:#f92672">=</span>artifactory <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                                       --snapshot-volumes <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                                       --schedule <span style="color:#e6db74">&#34;30 15 * * Sat&#34;</span></code></pre></div>
<h2 id="velero-restore">Velero Restore</h2>

<p>Restore a backup along with persistent volumes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ark restore create --from-backup artifactory-backup <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>                   --restore-volumes</code></pre></div>
<!-- Links Referenced -->
</main>
        
            <footer id="wb-info">
                <div class="landscape">
                    <nav class="container wb-navcurr">
                        <h2 class="invisible">About Aurora</h2>
                    </nav>
                </div>
            </footer>
        
</body>
</html>
